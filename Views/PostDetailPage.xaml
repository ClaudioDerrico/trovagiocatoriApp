<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="trovagiocatoriApp.Views.PostDetailPage"
             Title="Dettaglio Evento"
             BackgroundColor="#F8FAFC">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Colori aggiornati -->
            <Color x:Key="PrimaryColor">#24292F</Color>
            <!-- GitHub dark color -->
            <Color x:Key="SecondaryColor">#6366F1</Color>
            <Color x:Key="AccentColor">#F59E0B</Color>
            <Color x:Key="SuccessColor">#10B981</Color>
            <Color x:Key="ErrorColor">#EF4444</Color>
            <Color x:Key="BackgroundColor">#F8FAFC</Color>
            <Color x:Key="CardColor">#FFFFFF</Color>
            <Color x:Key="InputColor">#F1F5F9</Color>
            <Color x:Key="TextPrimary">#1E293B</Color>
            <Color x:Key="TextSecondary">#64748B</Color>
            <Color x:Key="BorderColor">#E2E8F0</Color>

            <!-- Stili Puliti -->
            <Style x:Key="CleanCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardColor}"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="BorderColor" Value="Transparent"/>
                <Setter Property="Padding" Value="24"/>
                <Setter Property="Margin" Value="16,8"/>
                <Setter Property="Shadow">
                    <Shadow Brush="#E2E8F0" Offset="0,4" Radius="12" Opacity="0.15"/>
                </Setter>
            </Style>

            <Style x:Key="SectionTitleStyle" TargetType="Label">
                <Setter Property="FontFamily" Value="OpenSansBold"/>
                <Setter Property="FontSize" Value="20"/>
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}"/>
                <Setter Property="Margin" Value="0,0,0,16"/>
            </Style>

            <Style x:Key="InfoLabelStyle" TargetType="Label">
                <Setter Property="FontFamily" Value="OpenSansRegular"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}"/>
                <Setter Property="LineHeight" Value="1.4"/>
            </Style>

            <Style x:Key="SecondaryTextStyle" TargetType="Label">
                <Setter Property="FontFamily" Value="OpenSansRegular"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="TextColor" Value="{StaticResource TextSecondary}"/>
            </Style>

            <Style x:Key="CleanButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontFamily" Value="OpenSansBold"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="HeightRequest" Value="48"/>
                <Setter Property="Shadow">
                    <Shadow Brush="{StaticResource PrimaryColor}" Offset="0,4" Radius="12" Opacity="0.2"/>
                </Setter>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" BackgroundColor="{StaticResource BackgroundColor}">



        <!-- Contenuto Principale -->
        <ScrollView Grid.Row="1" BackgroundColor="{StaticResource BackgroundColor}">
            <VerticalStackLayout Spacing="0" Padding="0,0,0,32">

                <!-- Informazioni Principali -->
                <Frame Style="{StaticResource CleanCardStyle}">
                    <VerticalStackLayout Spacing="24">

                        <!-- Titolo con Cuore Preferiti -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
                            <Label Grid.Column="0"
                                   x:Name="TitoloLabel"
                                   FontFamily="OpenSansBold"
                                   FontSize="24"
                                   TextColor="{StaticResource TextPrimary}"
                                   LineBreakMode="WordWrap"
                                   VerticalOptions="Center"
                                   Text="Partita di Calcio al Tramonto" />

                            <!-- Pulsante Preferiti integrato -->
                            <ImageButton Grid.Column="1"
                                         x:Name="FavoriteButton"
                                         Source="heart_empty.png"
                                         BackgroundColor="{StaticResource ErrorColor}"
                                         WidthRequest="44"
                                         HeightRequest="44"
                                         CornerRadius="22"
                                         Padding="10"
                                         VerticalOptions="Start"
                                         Clicked="OnFavoriteButtonClicked"/>
                        </Grid>

                        <!-- Autore -->
                        <HorizontalStackLayout Spacing="16" VerticalOptions="Center">
                            <Frame WidthRequest="50" 
                                   HeightRequest="50" 
                                   CornerRadius="25" 
                                   Padding="0" 
                                   IsClippedToBounds="True" 
                                   BorderColor="{StaticResource BorderColor}" 
                                   HasShadow="False">
                                <Image x:Name="ProfileImage" 
                                       Source="default_profile_icon.png" 
                                       Aspect="AspectFill"/>
                            </Frame>
                            <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                                <Label x:Name="AutoreLabel" 
                                       Text="Organizzatore" 
                                       FontFamily="OpenSansBold"
                                       FontSize="16" 
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label x:Name="AutoreUsernameLabel" 
                                       Text="@username" 
                                       Style="{StaticResource SecondaryTextStyle}"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- Info Evento in Grid -->
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="*,*" RowSpacing="16" ColumnSpacing="16">

                            <!-- Data e Ora -->
                            <HorizontalStackLayout Grid.Row="0" Grid.Column="0" Spacing="12">
                                <Label Text="ðŸ“…" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Data e Ora" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="DataOraLabel" 
                                           Text="Sabato 15 Marzo, ore 18:30" 
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- LocalitÃ  -->
                            <HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="12">
                                <Label Text="ðŸ“" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Luogo" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="LocalitaLabel" 
                                           Text="Milano, Lombardia" 
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Sport -->
                            <HorizontalStackLayout Grid.Row="1" Grid.Column="0" Spacing="12">
                                <Label Text="âš½" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Sport" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="SportLabel" 
                                           Text="Calcio" 
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Livello -->
                            <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="12">
                                <Label Text="ðŸ†" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Livello" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="LivelloLabel" 
                                           Text="ðŸŸ¡ Intermedio" 
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- NUOVO: Numero Giocatori -->
                            <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Spacing="12">
                                <Label Text="ðŸ‘¥" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Giocatori richiesti" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="NumeroGiocatoriLabel" 
                                           Text="Cerco 5 giocatori" 
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           TextColor="#2196F3"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Campo Sportivo -->
                            <HorizontalStackLayout Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Spacing="12"
                                                   IsVisible="{Binding Campo, Converter={StaticResource IsNotNullConverter}}">
                                <Label Text="ðŸŸï¸" FontSize="20"/>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Campo" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
                                    <Label x:Name="CampoNomeLabel" 
                                           Text="Centro Sportivo San Siro"
                                           Style="{StaticResource InfoLabelStyle}" 
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           LineBreakMode="TailTruncation"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Dettagli Campo (span su 2 colonne) -->
                            <VerticalStackLayout Grid.Row="4" Grid.ColumnSpan="2" Spacing="12" 
                                                 IsVisible="{Binding Campo, Converter={StaticResource IsNotNullConverter}}">
                                <Frame BackgroundColor="{StaticResource InputColor}" 
                                       CornerRadius="12" 
                                       Padding="16" 
                                       HasShadow="False">
                                    <VerticalStackLayout Spacing="8">
                                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="8" ColumnSpacing="16">
                                            <HorizontalStackLayout Grid.Row="0" Grid.Column="0" Spacing="8">
                                                <Label Text="ðŸ“" FontSize="14"/>
                                                <Label x:Name="CampoIndirizzoLabel" 
                                                       Text="Via dei Campi 15, Milano"
                                                       Style="{StaticResource InfoLabelStyle}" 
                                                       FontSize="13"
                                                       LineBreakMode="TailTruncation"/>
                                            </HorizontalStackLayout>

                                            <HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="8">
                                                <Label Text="ðŸ—ï¸" FontSize="14"/>
                                                <Label x:Name="CampoTipoLabel" 
                                                       Text="Erba Sintetica"
                                                       Style="{StaticResource InfoLabelStyle}"
                                                       FontSize="13"/>
                                            </HorizontalStackLayout>

                                            <HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="8">
                                                <Label Text="â„¹ï¸" FontSize="14"/>
                                                <Label x:Name="CampoDescrizioneLabel" 
                                                       Text="Campo regolamentare con spogliatoi"
                                                       Style="{StaticResource SecondaryTextStyle}"
                                                       FontSize="13"
                                                       LineBreakMode="WordWrap"/>
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <Button Text="Visualizza su Mappa" 
                                                x:Name="ViewOnMapButton"
                                                Style="{StaticResource CleanButtonStyle}"
                                                BackgroundColor="{StaticResource SuccessColor}"
                                                HeightRequest="36"
                                                FontSize="14"
                                                Clicked="OnViewOnMapClicked"
                                                Margin="0,8,0,0"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Descrizione integrata nello stesso rettangolo -->
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="{StaticResource BorderColor}" 
                                 Margin="0,16,0,0"/>

                        <VerticalStackLayout Spacing="8" Margin="0,16,0,0">
                            <Label Text="Descrizione" 
                                   FontFamily="OpenSansBold"
                                   FontSize="16"
                                   TextColor="{StaticResource TextPrimary}"/>
                            <Label x:Name="CommentoLabel"
                                   Style="{StaticResource InfoLabelStyle}"
                                   LineBreakMode="WordWrap"
                                   LineHeight="1.6"
                                   FontSize="15"
                                   Text="Cerchiamo giocatori per una partita amichevole ma competitiva. Livello intermedio-avanzato."/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Partecipazione -->
                <Frame Style="{StaticResource CleanCardStyle}">
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Partecipa all'evento" Style="{StaticResource SectionTitleStyle}"/>

                        <Frame BackgroundColor="{StaticResource InputColor}" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False">
                            <Editor x:Name="RispostaEditor"
                                    Placeholder="Scrivi un messaggio per l'organizzatore..."
                                    AutoSize="TextChanges"
                                    MinimumHeightRequest="80"
                                    TextColor="{StaticResource TextPrimary}"
                                    PlaceholderColor="{StaticResource TextSecondary}"
                                    BackgroundColor="Transparent"
                                    FontSize="16"
                                    Margin="16,12"/>
                        </Frame>

                        <Button x:Name="InviaRispostaButton" 
                                Text="Invia Messaggio" 
                                Style="{StaticResource CleanButtonStyle}" 
                                Clicked="OnInviaRispostaClicked"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Commenti -->
                <Frame Style="{StaticResource CleanCardStyle}">
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Commenti" Style="{StaticResource SectionTitleStyle}"/>

                        <CollectionView x:Name="CommentsCollectionView" 
                                        ItemsSource="{Binding Comments}"
                                        EmptyView="Nessun commento ancora...">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical" ItemSpacing="16"/>
                            </CollectionView.ItemsLayout>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame BackgroundColor="{StaticResource InputColor}" 
                                           CornerRadius="12" 
                                           Padding="16" 
                                           HasShadow="False"
                                           Margin="0">
                                        <VerticalStackLayout Spacing="8">
                                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                                <Label Text="ðŸ‘¤" FontSize="16" TextColor="{StaticResource AccentColor}"/>
                                                <Label Text="{Binding autore_username}" 
                                                       FontFamily="OpenSansBold" 
                                                       FontSize="14" 
                                                       TextColor="{StaticResource TextPrimary}"/>
                                                <Label Text="{Binding created_at, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                                       FontSize="12" 
                                                       TextColor="{StaticResource TextSecondary}"/>
                                            </HorizontalStackLayout>
                                            <Label Text="{Binding contenuto}" 
                                                   FontSize="14" 
                                                   TextColor="{StaticResource TextPrimary}"
                                                   LineBreakMode="WordWrap" 
                                                   LineHeight="1.4"
                                                   Margin="24,0,0,0"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>

                            <CollectionView.EmptyView>
                                <VerticalStackLayout Spacing="12" HorizontalOptions="Center" Padding="32">
                                    <Label Text="ðŸ’¬" FontSize="32" HorizontalOptions="Center" Opacity="0.5"/>
                                    <Label Text="Nessun commento ancora..." 
                                           HorizontalOptions="Center" 
                                           FontSize="16" 
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="Sii il primo a commentare!" 
                                           HorizontalOptions="Center" 
                                           FontSize="14" 
                                           TextColor="{StaticResource TextSecondary}"/>
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>