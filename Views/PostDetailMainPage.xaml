<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="trovagiocatoriApp.Views.PostDetailMainPage"
             Title="Dettaglio Evento"
             BackgroundColor="#F8FAFC">

	<ContentPage.Resources>
		<ResourceDictionary>
			<Color x:Key="PrimaryColor">#24292F</Color>
			<Color x:Key="SecondaryColor">#6366F1</Color>
			<Color x:Key="AccentColor">#F59E0B</Color>
			<Color x:Key="SuccessColor">#10B981</Color>
			<Color x:Key="ErrorColor">#EF4444</Color>
			<Color x:Key="BackgroundColor">#F8FAFC</Color>
			<Color x:Key="CardColor">#FFFFFF</Color>
			<Color x:Key="InputColor">#F1F5F9</Color>
			<Color x:Key="TextPrimary">#1E293B</Color>
			<Color x:Key="TextSecondary">#64748B</Color>
			<Color x:Key="BorderColor">#E2E8F0</Color>

			<Style x:Key="CleanCardStyle" TargetType="Frame">
				<Setter Property="BackgroundColor" Value="{StaticResource CardColor}"/>
				<Setter Property="CornerRadius" Value="16"/>
				<Setter Property="HasShadow" Value="True"/>
				<Setter Property="BorderColor" Value="Transparent"/>
				<Setter Property="Padding" Value="20"/>
				<Setter Property="Margin" Value="16,8"/>
				<Setter Property="Shadow">
					<Shadow Brush="#E2E8F0" Offset="0,4" Radius="12" Opacity="0.15"/>
				</Setter>
			</Style>

			<Style x:Key="SectionTitleStyle" TargetType="Label">
				<Setter Property="FontFamily" Value="OpenSansBold"/>
				<Setter Property="FontSize" Value="20"/>
				<Setter Property="TextColor" Value="{StaticResource TextPrimary}"/>
				<Setter Property="Margin" Value="0,0,0,16"/>
			</Style>

			<Style x:Key="InfoLabelStyle" TargetType="Label">
				<Setter Property="FontFamily" Value="OpenSansRegular"/>
				<Setter Property="FontSize" Value="16"/>
				<Setter Property="TextColor" Value="{StaticResource TextPrimary}"/>
				<Setter Property="LineHeight" Value="1.4"/>
			</Style>

			<Style x:Key="SecondaryTextStyle" TargetType="Label">
				<Setter Property="FontFamily" Value="OpenSansRegular"/>
				<Setter Property="FontSize" Value="14"/>
				<Setter Property="TextColor" Value="{StaticResource TextSecondary}"/>
			</Style>

			<Style x:Key="CleanButtonStyle" TargetType="Button">
				<Setter Property="BackgroundColor" Value="{StaticResource PrimaryColor}"/>
				<Setter Property="TextColor" Value="White"/>
				<Setter Property="FontFamily" Value="OpenSansBold"/>
				<Setter Property="FontSize" Value="16"/>
				<Setter Property="CornerRadius" Value="12"/>
				<Setter Property="HeightRequest" Value="48"/>
				<Setter Property="Shadow">
					<Shadow Brush="{StaticResource PrimaryColor}" Offset="0,4" Radius="12" Opacity="0.2"/>
				</Setter>
			</Style>
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid RowDefinitions="*,Auto" BackgroundColor="{StaticResource BackgroundColor}">

		<!-- Contenuto Principale -->
		<ScrollView Grid.Row="0" BackgroundColor="{StaticResource BackgroundColor}">
			<VerticalStackLayout Spacing="0" Padding="0,0,0,32">

				<!-- 1. Informazioni Principali -->
				<Frame Style="{StaticResource CleanCardStyle}">
					<VerticalStackLayout Spacing="24">
						<!-- Titolo con Cuore Preferiti -->
						<Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
							<Label Grid.Column="0" x:Name="TitoloLabel" FontFamily="OpenSansBold" FontSize="24" TextColor="{StaticResource TextPrimary}" LineBreakMode="WordWrap" VerticalOptions="Center" Text="Partita di Calcio al Tramonto" />
							<ImageButton Grid.Column="1" x:Name="FavoriteButton" Source="heart_empty.png" BackgroundColor="{StaticResource ErrorColor}" WidthRequest="44" HeightRequest="44" CornerRadius="22" Padding="10" VerticalOptions="Start" Clicked="OnFavoriteButtonClicked"/>
						</Grid>

						<!-- Autore -->
						<HorizontalStackLayout Spacing="16" VerticalOptions="Center">
							<Frame WidthRequest="50" HeightRequest="50" CornerRadius="25" Padding="0" IsClippedToBounds="True" BorderColor="{StaticResource BorderColor}" HasShadow="False">
								<Image x:Name="ProfileImage" Source="default_profile_icon.png" Aspect="AspectFill"/>
							</Frame>
							<VerticalStackLayout Spacing="4" VerticalOptions="Center">
								<Label x:Name="AutoreLabel" Text="Organizzatore" FontFamily="OpenSansBold" FontSize="16" TextColor="{StaticResource TextPrimary}"/>
								<Label x:Name="AutoreUsernameLabel" Text="@username" Style="{StaticResource SecondaryTextStyle}"/>
							</VerticalStackLayout>
						</HorizontalStackLayout>

						<!-- Info Evento in Grid -->
						<Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="*,*" RowSpacing="16" ColumnSpacing="16">
							<!-- Data e Ora -->
							<HorizontalStackLayout Grid.Row="0" Grid.Column="0" Spacing="12">
								<Label Text="📅" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Data e Ora" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="DataOraLabel" Text="Sabato 15 Marzo, ore 18:30" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Località -->
							<HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="12">
								<Label Text="📍" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Luogo" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="LocalitaLabel" Text="Milano, Lombardia" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Sport -->
							<HorizontalStackLayout Grid.Row="1" Grid.Column="0" Spacing="12">
								<Label Text="⚽" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Sport" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="SportLabel" Text="Calcio" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Livello -->
							<HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="12">
								<Label Text="🏆" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Livello" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="LivelloLabel" Text="🟡 Intermedio" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Numero Giocatori -->
							<HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Spacing="12">
								<Label Text="👥" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Giocatori richiesti" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="NumeroGiocatoriLabel" Text="Cerco 5 giocatori" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14" TextColor="#2196F3"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Campo Sportivo -->
							<HorizontalStackLayout Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Spacing="12" IsVisible="{Binding Campo, Converter={StaticResource IsNotNullConverter}}">
								<Label Text="🏟️" FontSize="20"/>
								<VerticalStackLayout Spacing="2">
									<Label Text="Campo" Style="{StaticResource SecondaryTextStyle}" FontSize="12"/>
									<Label x:Name="CampoNomeLabel" Text="Centro Sportivo San Siro" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="14" LineBreakMode="TailTruncation"/>
								</VerticalStackLayout>
							</HorizontalStackLayout>

							<!-- Dettagli Campo -->
							<VerticalStackLayout Grid.Row="4" Grid.ColumnSpan="2" Spacing="12" IsVisible="{Binding Campo, Converter={StaticResource IsNotNullConverter}}">
								<Frame BackgroundColor="{StaticResource InputColor}" CornerRadius="12" Padding="16" HasShadow="False">
									<VerticalStackLayout Spacing="8">
										<Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="8" ColumnSpacing="16">
											<HorizontalStackLayout Grid.Row="0" Grid.Column="0" Spacing="8">
												<Label Text="📍" FontSize="14"/>
												<Label x:Name="CampoIndirizzoLabel" Text="Via dei Campi 15, Milano" Style="{StaticResource InfoLabelStyle}" FontSize="13" LineBreakMode="TailTruncation"/>
											</HorizontalStackLayout>
											<HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="8">
												<Label Text="🏗️" FontSize="14"/>
												<Label x:Name="CampoTipoLabel" Text="Erba Sintetica" Style="{StaticResource InfoLabelStyle}" FontSize="13"/>
											</HorizontalStackLayout>
											<HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="8">
												<Label Text="ℹ️" FontSize="14"/>
												<Label x:Name="CampoDescrizioneLabel" Text="Campo regolamentare con spogliatoi" Style="{StaticResource SecondaryTextStyle}" FontSize="13" LineBreakMode="WordWrap"/>
											</HorizontalStackLayout>
										</Grid>
										<Button Text="Visualizza su Mappa" x:Name="ViewOnMapButton" Style="{StaticResource CleanButtonStyle}" BackgroundColor="{StaticResource SuccessColor}" HeightRequest="36" FontSize="14" Clicked="OnViewOnMapClicked" Margin="0,8,0,0"/>
									</VerticalStackLayout>
								</Frame>
							</VerticalStackLayout>
						</Grid>

						<!-- Descrizione -->
						<BoxView HeightRequest="1" BackgroundColor="{StaticResource BorderColor}" Margin="0,16,0,0"/>
						<VerticalStackLayout Spacing="8" Margin="0,16,0,0">
							<Label Text="Descrizione" FontFamily="OpenSansBold" FontSize="16" TextColor="{StaticResource TextPrimary}"/>
							<Label x:Name="CommentoLabel" Style="{StaticResource InfoLabelStyle}" LineBreakMode="WordWrap" LineHeight="1.6" FontSize="15" Text="Cerchiamo giocatori per una partita amichevole ma competitiva. Livello intermedio-avanzato."/>
						</VerticalStackLayout>
					</VerticalStackLayout>
				</Frame>

				<!-- 2. Partecipazione Evento - Visibile solo se NON è l'autore -->
				<Frame Style="{StaticResource CleanCardStyle}" x:Name="ParticipationFrame" IsVisible="False">
					<VerticalStackLayout Spacing="20">
						<Label Text="🎯 Partecipa all'evento" Style="{StaticResource SectionTitleStyle}"/>

						<!-- Status partecipazione e posti disponibili -->
						<Frame BackgroundColor="{StaticResource InputColor}" CornerRadius="12" Padding="16" HasShadow="False">
							<Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
								<HorizontalStackLayout Grid.Row="0" Spacing="12">
									<Label Text="👥" FontSize="16"/>
									<Label x:Name="PostiDisponibiliLabel" Text="3 posti disponibili su 5" Style="{StaticResource InfoLabelStyle}" FontAttributes="Bold" FontSize="15"/>
								</HorizontalStackLayout>
								<HorizontalStackLayout Grid.Row="1" Spacing="12">
									<Label Text="📍" FontSize="16"/>
									<Label x:Name="StatusPartecipazioneLabel" Text="Non sei ancora iscritto a questo evento" Style="{StaticResource InfoLabelStyle}" FontSize="14"/>
								</HorizontalStackLayout>
								<Button x:Name="JoinLeaveButton" Grid.Row="2" Text="PARTECIPA ALL'EVENTO" Style="{StaticResource CleanButtonStyle}" BackgroundColor="{StaticResource SuccessColor}" Clicked="OnJoinLeaveEventClicked" Margin="0,8,0,0"/>
							</Grid>
						</Frame>
					</VerticalStackLayout>
				</Frame>

				<!-- Messaggio per l'organizzatore -->
				<Frame Style="{StaticResource CleanCardStyle}" x:Name="OrganizerFrame" IsVisible="False">
					<VerticalStackLayout Spacing="15">
						<Label Text="👑 Sei l'organizzatore" Style="{StaticResource SectionTitleStyle}" TextColor="#FF6B35"/>

						<Frame BackgroundColor="#FFF8F0" CornerRadius="12" Padding="16" HasShadow="False" BorderColor="#FFE0B3">
							<VerticalStackLayout Spacing="8">
								<HorizontalStackLayout Spacing="12">
									<Label Text="🎯" FontSize="16"/>
									<Label Text="Hai creato questo evento" FontAttributes="Bold" FontSize="16" TextColor="#D2691E"/>
								</HorizontalStackLayout>
								<HorizontalStackLayout Spacing="12">
									<Label Text="👥" FontSize="16"/>
									<Label x:Name="OrganizerPostiLabel" Text="3 posti disponibili su 5" Style="{StaticResource InfoLabelStyle}" FontSize="15"/>
								</HorizontalStackLayout>
								<Label Text="💡 I partecipanti possono iscriversi al tuo evento. Vai alla sezione 'Partecipanti e Chat' per vedere chi si è iscritto e organizzare i dettagli."
                                       FontSize="13"
                                       TextColor="#8B4513"
                                       LineBreakMode="WordWrap"
                                       Margin="0,8,0,0"/>
							</VerticalStackLayout>
						</Frame>
					</VerticalStackLayout>
				</Frame>

			</VerticalStackLayout>
		</ScrollView>



		<!-- Barra di navigazione inferiore -->	
        <Grid Grid.Row="1" BackgroundColor="White" HeightRequest="80" Padding="16,8">
            <Grid.Shadow>
                <Shadow Brush="#000000" Offset="0,-3" Radius="8" Opacity="0.1"/>
            </Grid.Shadow>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Bottone Partecipanti -->
            <Button Grid.Column="0"
			Text="👥 Partecipanti"
			Style="{StaticResource CleanButtonStyle}"
			BackgroundColor="#2196F3"
			FontSize="12"
			HeightRequest="44"
			Margin="0,0,4,0"
			Clicked="OnNavigateToParticipantsClicked"/>

            <!-- AGGIORNATO: Bottone Chat Live - Visibile solo per partecipanti, non per organizzatori -->
            <Button Grid.Column="1"
			x:Name="ChatButton"
			Style="{StaticResource CleanButtonStyle}"
			BackgroundColor="#10B981"
			FontSize="12"
			HeightRequest="44"
			Margin="2,0,2,0"
			Clicked="OnNavigateToChatClicked">
                <!-- NUOVO: Logica di visibilità e testo dinamico -->
                <Button.Triggers>
                    <!-- Se l'utente è l'organizzatore -->
                    <DataTrigger TargetType="Button" Binding="{Binding IsPostAuthor}" Value="True">
                        <Setter Property="Text" Value="💬 Gestisci Chat"/>
                        <Setter Property="BackgroundColor" Value="#FF9800"/>
                    </DataTrigger>
                    <!-- Se l'utente è un partecipante -->
                    <DataTrigger TargetType="Button" Binding="{Binding IsPostAuthor}" Value="False">
                        <Setter Property="Text" Value="💬 Chat Live"/>
                        <Setter Property="BackgroundColor" Value="#10B981"/>
                    </DataTrigger>
                </Button.Triggers>
            </Button>

            <!-- Bottone Commenti -->
            <Button Grid.Column="2"
			Text="💭 Commenti"
			Style="{StaticResource CleanButtonStyle}"
			BackgroundColor="#FF9800"
			FontSize="12"
			HeightRequest="44"
			Margin="4,0,0,0"
			Clicked="OnNavigateToParticipantsClicked"/>
        </Grid>
    </Grid>
</ContentPage>