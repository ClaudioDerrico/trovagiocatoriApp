<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:trovagiocatoriApp.Converters"
             x:Class="trovagiocatoriApp.Views.ProfilePage"
             Title="Profilo Utente"
             BackgroundColor="#F8FAFC">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
            <converters:AvailabilityColorConverter x:Key="AvailabilityColorConverter"/>
            <!-- NUOVO: Converter per invertire boolean -->
            <converters:InvertBooleanConverter x:Key="InvertBooleanConverter"/>

            <!-- Colori del tema -->
            <Color x:Key="PrimaryColor">#24292F</Color>
            <Color x:Key="SecondaryColor">#6366F1</Color>
            <Color x:Key="AccentColor">#F59E0B</Color>
            <Color x:Key="SuccessColor">#10B981</Color>
            <Color x:Key="ErrorColor">#EF4444</Color>
            <Color x:Key="BackgroundColor">#F8FAFC</Color>
            <Color x:Key="CardColor">#FFFFFF</Color>
            <Color x:Key="InputColor">#F1F5F9</Color>
            <Color x:Key="TextPrimary">#1E293B</Color>
            <Color x:Key="TextSecondary">#64748B</Color>
            <Color x:Key="BorderColor">#E2E8F0</Color>

            <!-- Stili per i tab -->
            <Style x:Key="TabButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="TextColor" Value="{StaticResource TextSecondary}"/>
                <Setter Property="FontFamily" Value="OpenSansSemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="BorderWidth" Value="0"/>
                <Setter Property="CornerRadius" Value="0"/>
                <Setter Property="HeightRequest" Value="48"/>
                <Setter Property="Padding" Value="16,0"/>
            </Style>

            <Style x:Key="ActiveTabButtonStyle" TargetType="Button" BasedOn="{StaticResource TabButtonStyle}">
                <Setter Property="TextColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="FontAttributes" Value="Bold"/>
            </Style>

            <!-- Stili per le card -->
            <Style x:Key="CleanCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardColor}"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="BorderColor" Value="Transparent"/>
                <Setter Property="Padding" Value="20"/>
                <Setter Property="Margin" Value="16,8"/>
                <Setter Property="Shadow">
                    <Shadow Brush="#E2E8F0" Offset="0,4" Radius="12" Opacity="0.15"/>
                </Setter>
            </Style>

            <Style x:Key="SectionTitleStyle" TargetType="Label">
                <Setter Property="FontFamily" Value="OpenSansBold"/>
                <Setter Property="FontSize" Value="20"/>
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}"/>
                <Setter Property="Margin" Value="0,0,0,16"/>
            </Style>

            <Style x:Key="CleanButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontFamily" Value="OpenSansBold"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="HeightRequest" Value="48"/>
                <Setter Property="Shadow">
                    <Shadow Brush="{StaticResource PrimaryColor}" Offset="0,4" Radius="12" Opacity="0.2"/>
                </Setter>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*,Auto" BackgroundColor="{StaticResource BackgroundColor}">

        <!-- Header Profilo con Logo Centrato -->
        <Frame Grid.Row="0" Style="{StaticResource CleanCardStyle}" Margin="16,16,16,8">
            <VerticalStackLayout Spacing="16" Padding="0,16,0,16">

                <!-- Logo/Foto profilo centrata in alto -->
                <Grid HorizontalOptions="Center">
                    <Border Stroke="White" StrokeThickness="4" StrokeShape="RoundRectangle 60" WidthRequest="120" HeightRequest="120" BackgroundColor="White">
                        <Border.Shadow>
                            <Shadow Brush="#40000000" Offset="0,4" Radius="8" Opacity="0.3"/>
                        </Border.Shadow>
                        <Image x:Name="ProfileImage" Aspect="AspectFill" Source="default_avatar.png"/>
                    </Border>

                    <!-- Badge verificato -->
                    <Border Stroke="White" StrokeThickness="3" StrokeShape="RoundRectangle 14" WidthRequest="28" HeightRequest="28" BackgroundColor="#4CAF50" HorizontalOptions="End" VerticalOptions="End" Margin="0,0,8,8">
                        <Label Text="âœ“" TextColor="White" FontSize="14" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                    </Border>
                </Grid>

                <!-- Username prominente centrato -->
                <Frame BackgroundColor="#F8F9FA" CornerRadius="16" Padding="16,8" HasShadow="False" HorizontalOptions="Center">
                    <Label x:Name="UsernameLabel" 
                           FontSize="22" 
                           FontAttributes="Bold" 
                           TextColor="#1E293B"
                           FontFamily="OpenSansBold"
                           HorizontalOptions="Center"/>
                </Frame>

                <!-- Card informazioni utente sotto -->
                <Frame x:Name="UserInfoFrame" 
                       BackgroundColor="#FFFFFF" 
                       CornerRadius="12" 
                       Padding="16" 
                       HasShadow="True" 
                       BorderColor="#E2E8F0" 
                       HorizontalOptions="FillAndExpand">
                                <Grid ColumnDefinitions="Auto,12,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="10">                

                        <!-- Nome -->
                        <Frame Grid.Row="0" Grid.Column="0" BackgroundColor="#E3F2FD" CornerRadius="8" Padding="8,4" HasShadow="False" VerticalOptions="Center">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸ‘¤" FontSize="14"/>
                                <Label Text="Nome" FontAttributes="Bold" FontSize="13" TextColor="#1976D2"/>
                            </HorizontalStackLayout>
                        </Frame>
                        <Label Grid.Row="0" Grid.Column="2" x:Name="NameLabel" FontSize="14" TextColor="#2D3748" FontAttributes="Bold" VerticalOptions="Center"/>

                        <!-- Cognome -->
                        <Frame Grid.Row="1" Grid.Column="0" BackgroundColor="#F3E5F5" CornerRadius="8" Padding="8,4" HasShadow="False" VerticalOptions="Center">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸ·ï¸" FontSize="14"/>
                                <Label Text="Cognome" FontAttributes="Bold" FontSize="13" TextColor="#7B1FA2"/>
                            </HorizontalStackLayout>
                        </Frame>
                        <Label Grid.Row="1" Grid.Column="2" x:Name="SurnameLabel" FontSize="14" TextColor="#2D3748" FontAttributes="Bold" VerticalOptions="Center"/>

                        <!-- Email -->
                        <Frame Grid.Row="2" Grid.Column="0" BackgroundColor="#E8F5E8" CornerRadius="8" Padding="8,4" HasShadow="False" VerticalOptions="Center">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="ðŸ“§" FontSize="14"/>
                                <Label Text="Email" FontAttributes="Bold" FontSize="13" TextColor="#388E3C"/>
                            </HorizontalStackLayout>
                        </Frame>
                        <Label Grid.Row="2" Grid.Column="2" x:Name="EmailLabel" FontSize="13" TextColor="#2D3748" LineBreakMode="TailTruncation" VerticalOptions="Center" FontFamily="OpenSansRegular"/>
                    </Grid>
                </Frame>
            </VerticalStackLayout>
        </Frame>

        <!-- Tab Navigation -->
        <Frame Grid.Row="1" BackgroundColor="White" CornerRadius="12" HasShadow="True" Margin="16,0,16,0" Padding="0">
            <Grid ColumnDefinitions="*,*,*">
                <Button Grid.Column="0"
                        x:Name="MyPostsTabButton"
                        Text="ðŸ“ I Miei Post"
                        Style="{StaticResource ActiveTabButtonStyle}"
                        Clicked="OnMyPostsTabClicked"/>
                <Button Grid.Column="1"
                        x:Name="MyEventsTabButton"
                        Text="ðŸ“… I Miei Eventi"
                        Style="{StaticResource TabButtonStyle}"
                        Clicked="OnMyEventsTabClicked"/>
                <Button Grid.Column="2"
                        x:Name="FavoritesTabButton"
                        Text="â¤ï¸ Preferiti"
                        Style="{StaticResource TabButtonStyle}"
                        Clicked="OnFavoritesTabClicked"/>

                <!-- Indicator line -->
                <BoxView Grid.Column="0"
                         x:Name="TabIndicator"
                         HeightRequest="3"
                         BackgroundColor="{StaticResource PrimaryColor}"
                         VerticalOptions="End"
                         HorizontalOptions="FillAndExpand"/>
            </Grid>
        </Frame>

        <!-- Content Area -->
        <ScrollView Grid.Row="2" Padding="0,8,0,0">
            <Grid>
                <!-- I Miei Post Content -->
                <VerticalStackLayout x:Name="MyPostsContent" IsVisible="True" Spacing="12" Padding="16">
                    <CollectionView x:Name="MyPostsCollectionView" SelectionMode="Single" SelectionChanged="OnMyPostSelected">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White" CornerRadius="12" Padding="16" HasShadow="True" Margin="0">
                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="8">
                                        <!-- Header con titolo e status -->
                                        <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" Text="{Binding titolo}" FontAttributes="Bold" FontSize="16" TextColor="#2E7D32" LineBreakMode="TailTruncation"/>
                                            <Frame Grid.Column="1" CornerRadius="8" Padding="6,3" HasShadow="False" VerticalOptions="Center">
                                                <Frame.Triggers>
                                                    <DataTrigger TargetType="Frame" Binding="{Binding is_full}" Value="True">
                                                        <Setter Property="BackgroundColor" Value="#FF5722"/>
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Frame" Binding="{Binding is_full}" Value="False">
                                                        <Setter Property="BackgroundColor" Value="#4CAF50"/>
                                                    </DataTrigger>
                                                </Frame.Triggers>
                                                <Label FontSize="10" FontAttributes="Bold" TextColor="White">
                                                    <Label.Triggers>
                                                        <DataTrigger TargetType="Label" Binding="{Binding is_full}" Value="True">
                                                            <Setter Property="Text" Value="COMPLETO"/>
                                                        </DataTrigger>
                                                        <DataTrigger TargetType="Label" Binding="{Binding is_full}" Value="False">
                                                            <Setter Property="Text" Value="APERTO"/>
                                                        </DataTrigger>
                                                    </Label.Triggers>
                                                </Label>
                                            </Frame>
                                        </Grid>

                                        <!-- Sport e Data/Ora -->
                                        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto">
                                            <HorizontalStackLayout Grid.Column="0" Spacing="6">
                                                <Label Text="âš½" FontSize="14"/>
                                                <Label Text="{Binding sport}" FontSize="14" FontAttributes="Bold" TextColor="#FF6B35"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Grid.Column="2" Spacing="10">
                                                <Label Text="{Binding data_partita}" FontSize="13" TextColor="#666"/>
                                                <Label Text="{Binding ora_partita}" FontSize="13" FontAttributes="Bold" TextColor="#666"/>
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <!-- LocalitÃ  -->
                                        <HorizontalStackLayout Grid.Row="2" Spacing="8">
                                            <Label Text="ðŸ“" FontSize="14"/>
                                            <Label Text="{Binding citta}" FontSize="13" TextColor="#666"/>
                                            <Label Text="|" FontSize="13" TextColor="#DDD"/>
                                            <Label Text="{Binding provincia}" FontSize="13" TextColor="#666"/>
                                        </HorizontalStackLayout>

                                        <!-- Statistiche partecipanti -->
                                        <Frame Grid.Row="3" BackgroundColor="#E8F5E8" CornerRadius="8" Padding="12,8" HasShadow="False" Margin="0,4,0,0">
                                            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                                                <VerticalStackLayout Grid.Column="0" Spacing="2" HorizontalOptions="Center">
                                                    <Label Text="{Binding numero_giocatori}" FontSize="16" FontAttributes="Bold" TextColor="#2E7D32" HorizontalOptions="Center"/>
                                                    <Label Text="Richiesti" FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                                                </VerticalStackLayout>
                                                <VerticalStackLayout Grid.Column="1" Spacing="2" HorizontalOptions="Center">
                                                    <Label Text="{Binding partecipanti_iscritti}" FontSize="16" FontAttributes="Bold" TextColor="#FF9800" HorizontalOptions="Center"/>
                                                    <Label Text="Iscritti" FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                                                </VerticalStackLayout>
                                                <VerticalStackLayout Grid.Column="2" Spacing="2" HorizontalOptions="Center">
                                                    <Label Text="{Binding posti_disponibili}" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center">
                                                        <Label.TextColor>
                                                            <Binding Path="posti_disponibili">
                                                                <Binding.Converter>
                                                                    <converters:AvailabilityColorConverter/>
                                                                </Binding.Converter>
                                                            </Binding>
                                                        </Label.TextColor>
                                                    </Label>
                                                    <Label Text="Liberi" FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                                                </VerticalStackLayout>
                                            </Grid>
                                        </Frame>

                                        <!-- Livello e Campo -->
                                        <HorizontalStackLayout Grid.Row="4" Spacing="15" Margin="0,4,0,0">
                                            <HorizontalStackLayout Spacing="4">
                                                <Label Text="ðŸ†" FontSize="12"/>
                                                <Label Text="{Binding livello}" FontSize="12" TextColor="#888"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="4" IsVisible="{Binding campo, Converter={StaticResource IsNotNullConverter}}">
                                                <Label Text="ðŸŸï¸" FontSize="12"/>
                                                <Label Text="{Binding campo.nome}" FontSize="12" TextColor="#888" LineBreakMode="TailTruncation"/>
                                            </HorizontalStackLayout>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout Spacing="10" HorizontalOptions="Center" Padding="20">
                                <Label Text="ðŸ“" FontSize="40" HorizontalOptions="Center" Opacity="0.5"/>
                                <Label Text="Non hai ancora creato eventi" HorizontalOptions="Center" FontSize="16" TextColor="#888"/>
                                <Label Text="Crea il tuo primo evento per iniziare!" HorizontalOptions="Center" FontSize="14" TextColor="#AAA" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>

                <!-- I Miei Eventi Content - AGGIORNATO PER SUPPORTARE INVITI -->
                <VerticalStackLayout x:Name="MyEventsContent" IsVisible="False" Spacing="12" Padding="16">
                    <CollectionView x:Name="CalendarEventsCollectionView" SelectionMode="Single" SelectionChanged="OnCalendarEventSelected">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White" CornerRadius="12" Padding="16" HasShadow="True" Margin="0">
                                    <!-- NUOVO: Frame speciale per gli inviti -->
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame" Binding="{Binding IsInvite}" Value="True">
                                            <Setter Property="BackgroundColor" Value="#FFF3E0"/>
                                            <Setter Property="BorderColor" Value="#FF9800"/>
                                        </DataTrigger>
                                    </Frame.Triggers>

                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="6">
                                        <!-- Header con data e sport -->
                                        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
                                            <Frame Grid.Column="0" CornerRadius="8" Padding="8,4" HasShadow="False" VerticalOptions="Center">
                                                <!-- Colore diverso per gli inviti -->
                                                <Frame.Triggers>
                                                    <DataTrigger TargetType="Frame" Binding="{Binding IsInvite}" Value="True">
                                                        <Setter Property="BackgroundColor" Value="#FF9800"/>
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Frame" Binding="{Binding IsInvite}" Value="False">
                                                        <Setter Property="BackgroundColor" Value="#2196F3"/>
                                                    </DataTrigger>
                                                </Frame.Triggers>
                                                <Label Text="{Binding data_partita}" TextColor="White" FontSize="12" FontAttributes="Bold"/>
                                            </Frame>

                                            <Label Grid.Column="1" FontAttributes="Bold" FontSize="16" VerticalOptions="Center" Margin="12,0,0,0">
                                                <!-- Testo diverso per inviti vs eventi normali -->
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label" Binding="{Binding IsInvite}" Value="True">
                                                        <Setter Property="Text" Value="{Binding sport, StringFormat='ðŸ“© INVITO: {0}'}"/>
                                                        <Setter Property="TextColor" Value="#FF6B35"/>
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label" Binding="{Binding IsInvite}" Value="False">
                                                        <Setter Property="Text" Value="{Binding sport, StringFormat='Partita di {0}'}"/>
                                                        <Setter Property="TextColor" Value="#2196F3"/>
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>

                                            <Label Grid.Column="2" Text="{Binding ora_partita}" FontSize="14" FontAttributes="Bold" TextColor="#666" VerticalOptions="Center"/>
                                        </Grid>

                                        <!-- Titolo evento -->
                                        <Label Grid.Row="1" Text="{Binding titolo}" FontSize="15" FontAttributes="Bold" TextColor="#333" LineBreakMode="TailTruncation" Margin="0,4,0,0"/>

                                        <!-- LocalitÃ  -->
                                        <HorizontalStackLayout Grid.Row="2" Spacing="8" Margin="0,2,0,0">
                                            <Label Text="ðŸ“" FontSize="14"/>
                                            <Label Text="{Binding citta}" FontSize="13" TextColor="#666"/>
                                            <Label Text="|" FontSize="13" TextColor="#DDD"/>
                                            <Label Text="{Binding provincia}" FontSize="13" TextColor="#666"/>
                                        </HorizontalStackLayout>

                                        <!-- NUOVO: Badge speciale per inviti -->
                                        <Frame Grid.Row="3" CornerRadius="8" Padding="8,4" HasShadow="False" Margin="0,4,0,0" IsVisible="{Binding IsInvite}">
                                            <Frame.Triggers>
                                                <DataTrigger TargetType="Frame" Binding="{Binding IsInvite}" Value="True">
                                                    <Setter Property="BackgroundColor" Value="#E3F2FD"/>
                                                    <Setter Property="BorderColor" Value="#2196F3"/>
                                                </DataTrigger>
                                            </Frame.Triggers>
                                            <HorizontalStackLayout Spacing="8">
                                                <Label Text="ðŸ‘¤" FontSize="14"/>
                                                <Label Text="{Binding autore_email, StringFormat='Invito da: {0}'}" FontSize="13" TextColor="#1976D2" FontAttributes="Bold"/>
                                            </HorizontalStackLayout>
                                        </Frame>

                                        <!-- Dettagli aggiuntivi (solo per eventi normali) -->
                                        <HorizontalStackLayout Grid.Row="4" Spacing="15" Margin="0,4,0,0" IsVisible="{Binding IsInvite, Converter={StaticResource InvertBooleanConverter}}">
                                            <HorizontalStackLayout Spacing="4">
                                                <Label Text="ðŸ†" FontSize="12"/>
                                                <Label Text="{Binding livello}" FontSize="12" TextColor="#888"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="4" IsVisible="{Binding campo, Converter={StaticResource IsNotNullConverter}}">
                                                <Label Text="ðŸŸï¸" FontSize="12"/>
                                                <Label Text="{Binding campo.nome}" FontSize="12" TextColor="#888" LineBreakMode="TailTruncation"/>
                                            </HorizontalStackLayout>
                                        </HorizontalStackLayout>

                                        <!-- NUOVO: Pulsanti azione per inviti -->
                                        <Grid Grid.Row="4" ColumnDefinitions="*,*" ColumnSpacing="8" Margin="0,8,0,0" IsVisible="{Binding IsInvite}">
                                            <Button Grid.Column="0"
                                                    Text="âœ… Accetta"
                                                    FontSize="12"
                                                    HeightRequest="32"
                                                    CornerRadius="6"
                                                    BackgroundColor="#4CAF50"
                                                    TextColor="White"
                                                    FontAttributes="Bold"
                                                    Clicked="OnAcceptInviteClicked"
                                                    CommandParameter="{Binding .}"/>
                                            <Button Grid.Column="1"
                                                    Text="âŒ Rifiuta"
                                                    FontSize="12"
                                                    HeightRequest="32"
                                                    CornerRadius="6"
                                                    BackgroundColor="#F44336"
                                                    TextColor="White"
                                                    FontAttributes="Bold"
                                                    Clicked="OnRejectInviteClicked"
                                                    CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout Spacing="10" HorizontalOptions="Center" Padding="20">
                                <Label Text="ðŸ“…" FontSize="40" HorizontalOptions="Center" Opacity="0.5"/>
                                <Label Text="Nessun evento in programma" HorizontalOptions="Center" FontSize="16" TextColor="#888"/>
                                <Label Text="Iscriviti agli eventi per vederli qui!" HorizontalOptions="Center" FontSize="14" TextColor="#AAA" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>

                <!-- Preferiti Content -->
                <VerticalStackLayout x:Name="FavoritesContent" IsVisible="False" Spacing="12" Padding="16">
                    <CollectionView x:Name="FavoritesCollectionView" SelectionMode="Single" SelectionChanged="OnFavoriteSelected">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White" CornerRadius="12" Padding="16" HasShadow="True" Margin="0">
                                    <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                        <!-- Titolo -->
                                        <Label Grid.Row="0" Text="{Binding titolo}" FontAttributes="Bold" FontSize="16" TextColor="#FF5A5F" LineBreakMode="TailTruncation"/>

                                        <!-- LocalitÃ  e Sport -->
                                        <HorizontalStackLayout Grid.Row="1" Spacing="15">
                                            <HorizontalStackLayout Spacing="6">
                                                <Label Text="ðŸ“" FontSize="14"/>
                                                <Label Text="{Binding citta}" FontSize="14" TextColor="#666"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="6">
                                                <Label Text="âš½" FontSize="14"/>
                                                <Label Text="{Binding sport}" FontSize="14" TextColor="#FC4C02" FontAttributes="Bold"/>
                                            </HorizontalStackLayout>
                                        </HorizontalStackLayout>

                                        <!-- Data e Ora -->
                                        <HorizontalStackLayout Grid.Row="2" Spacing="15">
                                            <HorizontalStackLayout Spacing="6">
                                                <Label Text="ðŸ“…" FontSize="13"/>
                                                <Label Text="{Binding DataPartitaLong}" FontSize="13" TextColor="#888"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="6">
                                                <Label Text="ðŸ•" FontSize="13"/>
                                                <Label Text="{Binding OraPartitaFormatted}" FontSize="13" TextColor="#888"/>
                                            </HorizontalStackLayout>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout Spacing="10" HorizontalOptions="Center" Padding="20">
                                <Label Text="â¤ï¸" FontSize="40" HorizontalOptions="Center" Opacity="0.5"/>
                                <Label Text="Nessun evento nei preferiti" HorizontalOptions="Center" FontSize="16" TextColor="#888"/>
                                <Label Text="Aggiungi eventi ai preferiti per vederli qui!" HorizontalOptions="Center" FontSize="14" TextColor="#AAA" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>
            </Grid>
        </ScrollView>

        <!-- Bottom Buttons -->
        <Grid Grid.Row="3" BackgroundColor="White" Padding="16" ColumnDefinitions="*,*" ColumnSpacing="12">
            <Grid.Shadow>
                <Shadow Brush="#000000" Offset="0,-3" Radius="8" Opacity="0.1"/>
            </Grid.Shadow>

            <Button Grid.Column="0"
                    Text="ðŸ”’ Cambia Password"
                    Style="{StaticResource CleanButtonStyle}"
                    BackgroundColor="#5B9CFD"
                    FontSize="14"
                    Clicked="OnNavigateToChangePassword"/>

            <Button Grid.Column="1"
                    Text="ðŸšª Logout"
                    Style="{StaticResource CleanButtonStyle}"
                    BackgroundColor="#FF5A5F"
                    FontSize="14"
                    Clicked="OnLogoutButtonClicked"/>
        </Grid>
    </Grid>
</ContentPage>